# E/I Microcircuit Simulation Config
# Run with: python -c "import bsim; w = bsim.BioWorld(); bsim.load_wiring(w, 'examples/configs/neuro_microcircuit.toml'); w.run(duration=0.3, tick_dt=0.0001); print([v['module'] for v in w.collect_visuals()])"

# External Poisson input
[modules.poisson]
class = "bsim.packs.neuro.PoissonInput"
args = { n = 40, rate_hz = 15.0, seed = 42 }

# Excitatory population (Regular Spiking)
[modules.exc]
class = "bsim.packs.neuro.IzhikevichPopulation"
args = { n = 40, preset = "RS", I_bias = 0.0, sample_indices = [0, 1, 2] }

# Inhibitory population (Fast Spiking)
[modules.inh]
class = "bsim.packs.neuro.IzhikevichPopulation"
args = { n = 10, preset = "FS", I_bias = 0.0, sample_indices = [0] }

# Synapses: External -> E
[modules.syn_ext_e]
class = "bsim.packs.neuro.ExpSynapseCurrent"
args = { n_pre = 40, n_post = 40, p_connect = 0.1, weight = 1.0, tau = 0.005, seed = 42 }

# Synapses: E -> E
[modules.syn_ee]
class = "bsim.packs.neuro.ExpSynapseCurrent"
args = { n_pre = 40, n_post = 40, p_connect = 0.1, weight = 0.3, tau = 0.005, seed = 43 }

# Synapses: E -> I
[modules.syn_ei]
class = "bsim.packs.neuro.ExpSynapseCurrent"
args = { n_pre = 40, n_post = 10, p_connect = 0.1, weight = 0.5, tau = 0.005, seed = 44 }

# Synapses: I -> E
[modules.syn_ie]
class = "bsim.packs.neuro.ExpSynapseCurrent"
args = { n_pre = 10, n_post = 40, p_connect = 0.1, weight = -1.5, tau = 0.010, seed = 45 }

# Synapses: I -> I
[modules.syn_ii]
class = "bsim.packs.neuro.ExpSynapseCurrent"
args = { n_pre = 10, n_post = 10, p_connect = 0.1, weight = -0.5, tau = 0.010, seed = 46 }

# Monitors
[modules.spike_mon_e]
class = "bsim.packs.neuro.SpikeMonitor"
args = { max_neurons = 40, width = 600, height = 200 }

[modules.spike_mon_i]
class = "bsim.packs.neuro.SpikeMonitor"
args = { max_neurons = 10, width = 600, height = 100 }

[modules.rate_mon]
class = "bsim.packs.neuro.RateMonitor"
args = { window_size = 0.02, n_neurons = 50 }

[modules.state_mon]
class = "bsim.packs.neuro.StateMonitor"
args = { max_points = 5000 }

[modules.metrics]
class = "bsim.packs.neuro.NeuroMetrics"
args = { n_neurons = 50 }

# Wiring

[[wiring]]
from = "poisson.spikes"
to = ["syn_ext_e.spikes"]

[[wiring]]
from = "syn_ext_e.current"
to = ["exc.current"]

[[wiring]]
from = "exc.spikes"
to = ["syn_ee.spikes", "syn_ei.spikes", "spike_mon_e.spikes", "rate_mon.spikes", "metrics.spikes"]

[[wiring]]
from = "exc.state"
to = ["state_mon.state"]

[[wiring]]
from = "inh.spikes"
to = ["syn_ie.spikes", "syn_ii.spikes", "spike_mon_i.spikes", "rate_mon.spikes"]

[[wiring]]
from = "syn_ee.current"
to = ["exc.current"]

[[wiring]]
from = "syn_ie.current"
to = ["exc.current"]

[[wiring]]
from = "syn_ei.current"
to = ["inh.current"]

[[wiring]]
from = "syn_ii.current"
to = ["inh.current"]
